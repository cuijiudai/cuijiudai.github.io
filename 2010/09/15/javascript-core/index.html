<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JavaScript core | 美拓blog | 做个有趣的人</title>

  
  <meta name="author" content="独孤逸辰">
  

  
  <meta name="description" content="互联网开发者，金融爱好者,关注农业民生。">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="JavaScript core"/>

  <meta property="og:site_name" content="美拓blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="美拓blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">美拓blog</a>
    </h1>
    <p class="site-description">做个有趣的人</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article >

  
    
    <h3 class="article-title"><span>JavaScript core</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2010/09/15/javascript-core/" rel="bookmark">
        <time class="entry-date published" datetime="2010-09-15T13:20:55.000Z">
          2010-09-15
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <div class="entrytext"><br><div class="ds-toc"><br><br>1.  <a href="#an-object" title="An object">An object</a><br>2.  <a href="#a-prototype-chain" title="A prototype chain">A prototype chain</a><br>3.  <a href="#constructor" title="Constructor">Constructor</a><br>4.  <a href="#execution-context-stack" title="Execution context stack">Execution context stack</a><br>5.  <a href="#execution-context" title="Execution context">Execution context</a><br>6.  <a href="#variable-object" title="Variable object">Variable object</a><br>7.  <a href="#activation-object" title="Activation object">Activation object</a><br>8.  <a href="#scope-chain" title="Scope chain">Scope chain</a><br>9.  <a href="#closures" title="Closures">Closures</a><br>10.  <a href="#this-value" title="This value">This value</a><br>11.  <a href="#conclusion" title="Conclusion">Conclusion</a><br></div><br><a id="more"></a><br><br>This note is an overview and summary of what we’ve learned during studying of “<a href="http://dmitrysoshnikov.com/tag/ecma-262-3/" target="_blank" rel="external">ECMA-262-3 in detail</a>” series. Every section of the note contains references to the appropriate chapters of the <abbr title="ECMAScript 3rd edition">ES3</abbr> series which you, if have a wish and interest, may read and get deeper explanation and descriptions.<span id="more"> </span><br><br>An audience of the note: experienced programmers, professionals.<br><br>We start from considering of an <em>object</em> concept, which is a basis of ECMAScript.<br><br>## <a href="#an-object">An object</a><br><br>ECMAScript being a highly-abstracted object-oriented language operates with <em>objects</em>. There are also <em>primitives</em>, but they, when needed, are also converted to objects.<br><br>An object is a <em>collection of properties</em> and has a <em>single prototype object</em>. The prototype may be either also an object or the <em>null</em> value.<br><br>Let’s take a basic figure of an object with which we will operate in the following descriptions. A prototype of an object is referenced by the internal [[Prototype]] property. However, in figures we will use “<strong>&lt;internal-property&gt;</strong>” notation, and in particular for the prototype object: <strong><em>proto</em></strong> (that’s moreover, is a real, but non-standard, implementation in some engines, e.g. SpiderMonkey).<br><br>For the code:<br><div id="highlighter_311459" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>foo = {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``x: 10,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``y: 20</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>};</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>we have the structure with two explicit <em>own</em> properties and one implicit <strong>proto</strong> property, which is the reference to the prototype of “foo”:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/basic-object.png" alt="Figure 1\. A basic object with a prototype." title="Figure 1\. A basic object with a prototype."><br><br>Figure 1. A basic object with a prototype.<br><br>What for these prototypes are needed? Let’s consider a <em>prototype chain</em> concept to answer this question.<br><br>## <a href="#a-prototype-chain">A prototype chain</a><br><br>Prototype objects are also just simple objects and may have their own prototypes. If a prototype has a non-null reference to its prototype, and so on, this is called the <em>prototype chain</em>.<br><br>A prototype chain is a <em>finite</em> chain of objects which is used to implemented <em>inheritance</em> and <em>shared properties</em>.<br><br>Consider the case when we have two objects which differ only in some small part and all the other part is the same for both objects. Obviously, for a good designed system, we would like to <em>reuse</em> that similar functionality/code without repeating it in every single object. In class-based systems, this <em>code reuse</em> stylistics is called the <em>class-based inheritance</em> — you put similar functionality into the class A, and provide classes B and C which inherit from A and have their own small additional changes.<br><br>ECMAScript has no concept of a class. However, a code reuse stylistics do not differ much (though, in some aspects it’s even more flexible than class-based) and achieved via the <em>prototype chain</em>. This kind of inheritance is called a <em>delegation based inheritance</em> (or, closer to ECMAScript, a <em>prototype based inheritance</em>).<br><br>Similarly like in the example with classes “A”, “B” and “C”, in ECMAScript you create objects: “a”, “b”, and “c”. Thus, object “a” stores this common part of both “b” and “c” objects. And “b” and “c” store just their own additional properties or methods.<br><div id="highlighter_136044" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>a = {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``x: 10,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``calculate: ``function</code> <code>(z) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``return</code> <code>this``.x + ``this``.y + z</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>b = {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``y: 20,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``__proto__: a</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>c = {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``y: 30,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``__proto__: a</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// call the inherited method</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>b.calculate(30); ``// 60</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>c.calculate(40); ``// 80</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>Easy enough, isn’t it? We see that “b” and “c” have access to the “calculate” method which is defined in “a” object. And this is achieved exactly via this prototype chain. The rule is simple: if a property or a method is not found in the object itself (i.e. the object has no such an <em>own</em> property), then there is an attempt to find this property/method in the prototype chain. If the property is not found in the prototype, then a prototype of the prototype is considered, and so on, i.e. the whole prototype chain (absolutely the same is made in class-based inheritance, when resolving an inherited <em>method</em> — there we go through the <em>class chain</em>). The first found property/method with the same name is used. Thus, a found property is called <em>inherited</em> property. If the property is not found after the whole prototype chain lookup, then <em>undefined</em> value is returned.<br><br>Notice, that <em>this value</em> in using an inherited method is set to the <em>original</em> object, but not to the (prototype) object in which the method is found. I.e. in the example above “this.y” is taken from “b” and “c”, but not from “a”. However, “this.x” is taken from “a”, and again via the <em>prototype chain</em> mechanism.<br><br>If a prototype is not specified for an object explicitly, then the default value for “<strong>proto</strong>” is taken — <em>Object.prototype</em>. Object “Object.prototype” itself also has a <strong>proto</strong>, which is the <em>final link</em> of a chain and is set to <em>null</em>.<br><br>The next figure shows the inheritance hierarchy of our “a”, “b” and “c” objects:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/prototype-chain.png" alt="Figure 2\. A prototype chain." title="Figure 2\. A prototype chain."><br><br>Figure 2. A prototype chain.<br><br>Often it is needed to have objects with the <em>same or similar state structure</em> (i.e. the same set of properties), and with different <em>state values</em>. In this case we may use a <em>constructor function</em> which produces objects by <em>specified pattern</em>.<br><br>## <a href="#constructor">Constructor</a><br><br>Besides creation of objects by specified pattern, a <em>constructor</em> function does another useful thing — it <em>automatically sets a prototype object</em> for newly created objects. This prototype object is stored in the <em>ConstructorFunction.prototype</em> property.<br><br>E.g., we may rewrite previous example with “b” and “c” objects using a constructor function. Thus, the role of the object “a” (a prototype) is playing “Foo.prototype”:<br><div id="highlighter_889738" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// a constructor function</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>Foo(y) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// which may create objects</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// with specified pattern: they have after</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// creation own &quot;y&quot; property</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``this``.y = y;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// also &quot;Foo.prototype&quot; stores reference</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// to the prototype of newly created objects,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// so we may use it to define shared/inherited</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// properties or methods, so the same as in</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// previous example we have:</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// inherited property &quot;x&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>Foo.prototype.x = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// and inherited method &quot;calculate&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>Foo.prototype.calculate = ``function</code> <code>(z) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``this``.x + ``this``.y + z;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// now create our &quot;b&quot; and &quot;c&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// objects using &quot;pattern&quot; Foo</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>b = ``new</code> <code>Foo(20);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>c = ``new</code> <code>Foo(30);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// call the inherited method</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>b.calculate(30); ``// 60</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>c.calculate(40); ``// 80</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// let&#39;s show that we reference</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// properties we expect</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>console.log(</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``b.__proto__ === Foo.prototype, ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``c.__proto__ === Foo.prototype, ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// also &quot;Foo.prototype&quot; automatically creates</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// a special property &quot;constructor&quot;, which is a</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// reference to the constructor function itself;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// instances &quot;b&quot; and &quot;c&quot; may found it via</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// delegation and use to check their constructor</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``b.constructor === Foo, ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``c.constructor === Foo, ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``Foo.prototype.constructor === Foo ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``b.calculate === b.__proto__.calculate, ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``b.__proto__.calculate === Foo.prototype.calculate ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>);</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>This code may be presented as the following relationship:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/constructor-proto-chain.png" alt="Figure 3\. A constructor and objects relationship." title="Figure 3\. A constructor and objects relationship."><br><br>Figure 3. A constructor and objects relationship.<br><br>This figure again shows that every object has a prototype. Constructor function “Foo” also has its own <strong>proto</strong> which is “Function.prototype”, and which in turn also references via its <strong>proto</strong> property again to the “Object.prototype”. Thus, repeat, “Foo.prototype” is just an explicit property of “Foo” which refers to the prototype of “b” and “c” objects.<br><br>Formally, if to consider a concept of a “classification” (and we’ve exactly just now <em>classified</em> the new separated thing — Foo), a combination of the constructor function and the prototype object may be called as a “class”. Actually, e.g. Python’s “first-class” dynamic classes have absolutely the same implementation of properties/methods resolution. From this viewpoint, classes of Python are just a syntactic sugar for delegation based inheritance used in ECMAScript.<br><br>The complete and detailed explanation of this topic may be found in the Chapter 7 of ES3 series. There are two parts: <a href="http://dmitrysoshnikov.com/ecmascript/chapter-7-1-oop-general-theory/" target="_blank" rel="external">Chapter 7.1. OOP. The general theory</a>, where you will find description of various OOP paradigms and stylistics and also their comparison with ECMAScript, and <a href="http://dmitrysoshnikov.com/ecmascript/chapter-7-2-oop-ecmascript-implementation/" target="_blank" rel="external">Chapter 7.2. OOP. ECMAScript implementation</a>, devoted exactly to OOP in ECMAScript.<br><br>Now, when we know basic object aspects, let’s  see on how the <em>runtime program execution</em> is implemented in ECMAScript. This is what is called an <em>execution context stack</em>, every element of which is abstractly may be represented as also an object. Yes, ECMAScript almost everywhere operates with concept of an object<br><br>## <a href="#execution-context-stack">Execution context stack</a><br><br>There are three types of ECMAScript code: <em>global</em> code, <em>function</em> code and <em>eval</em> code. Every code is evaluated in its <em>execution context</em>. There is only one global context and may be many instances of function and <em>eval</em> execution contexts. Every call of a function, enters the function execution context and evaluates the function code type. Every call of <em>eval</em>, enters the <em>eval</em> execution context and evaluates its code.<br><br>Notice, that one function may generate infinite set of contexts, because every call to a function (even if the function calls itself recursively) produces a new context with a new <em>context state</em>:<br><div id="highlighter_773666" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>foo(bar) {}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// call the same function,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// generate three different</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// contexts in each call, with</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// different context state (e.g. value</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// of the &quot;bar&quot; argument)</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>foo(10);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>foo(20);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>foo(30);</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>An execution context may activate another context, e.g. a function calls another function (or the global context calls a global function), and so on. Logically, this is implemented as a stack, which is called the <em>execution context stack</em>.<br><br>A context which activates another context is called a <em>caller</em>. A context is being activated is called a <em>callee</em>. A callee at the same time may be a caller of some other callee (e.g. a function called from the global context, calls then some inner function).<br><br>When a caller activates (calls) a callee, the caller suspends its execution and passes the control flow to the callee. The callee is pushed onto the the stack and is becoming a <em>running (active)</em> execution context. After the callee’s context ends, it returns control to the caller, and the evaluation of the caller’s context proceeds (it may activate then other contexts) till the its end, and so on. A callee may simply <em>return</em> or exist with an <em>exception</em>. A thrown but not caught exception may exist (pop from the stack) one or more contexts.<br><br>I.e. all the ECMAScript <em>program runtime</em> is presented as the <em>execution context (EC) stack</em>, where <em>top</em> of this stack is an <em>active</em> context:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/ec-stack.png" alt="Figure 4\. An execution context stack." title="Figure 4\. An execution context stack."><br><br>Figure 4. An execution context stack.<br><br>When program begins it enters the <em>global execution context</em>, which is the <em>bottom</em> and the <em>first</em> element of the stack. Then the global code provides some initialization, creates needed objects and functions. During the execution of the global context, its code may activate some other (already created) function, which will enter their execution contexts, pushing new elements onto the stack, and so on. After the initialization is done, the runtime system is waiting for some <em>event</em> (e.g. user’s mouse click) which will activate some function and which will enter a new execution context.<br><br>In the next figure, having a some function context as “EC1″ and the global context as “Global EC”, we have the following stack modification on entering and exiting “EC1″ from the global context:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/ec-stack-changes.png" alt="Figure 5\. An execution context stack changes." title="Figure 5\. An execution context stack changes."><br><br>Figure 5. An execution context stack changes.<br><br>This is exactly how the runtime system of ECMAScript manages the execution of a code.<br><br>More information on execution context in ECMAScript may be found in the appropriate <a href="http://dmitrysoshnikov.com/ecmascript/chapter-1-execution-contexts/" target="_blank" rel="external">Chapter 1. Execution context</a>.<br><br>As we said, every execution context in the stack may be presented as an object. Let’s see on its structure and what kind of <em>state</em> (which properties) a context is needed to execute its code.<br><br>## <a href="#execution-context">Execution context</a><br><br>An execution context abstractly may be represented as a simple object. Every execution context has set of properties (which we may call a <em>context’s state</em>) necessary to track the execution progress of its associated code. In the next figure a structure of a context is shown:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/execution-context.png" alt="Figure 6\. An execution context structure." title="Figure 6\. An execution context structure."><br><br>Figure 6. An execution context structure.<br><br>Besides these three needed properties (a <em>variable object</em>, a <em>this value</em> and a <em>scope chain</em>), an execution context may have any additional state depending on implementation.<br><br>Let’s consider these important properties of a context in detail.<br><br>## <a href="#variable-object">Variable object</a><br><br>A <em>variable object</em> is a <em>scope of data</em> related with the execution context. It’s a special object associated with the context and which stores <em>variables</em> and <em>function declarations</em> are being defined within the context.<br><br>Notice, that <em>function expressions</em> (in contrast with <em>function declarations</em>) are <em>not included</em> into the variable object.<br><br>A variable object is an abstract concept. In different types of context, physically, it’s presented using different object. For example, in the global object the variable object is the <em>global object itself</em> (that’s why we have an ability to refer global variables via property names of the global object).<br><br>Let’s consider the following example in the global execution context:<br><div id="highlighter_715814" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>foo = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>bar() {} ``// function declaration, FD</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>(``function</code> <code>baz() {}); ``// function expression, FE</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>console.log(</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``this``.foo == foo, ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``window.bar == bar ``// true</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>console.log(baz); ``// ReferenceError, &quot;baz&quot; is not defined</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>Then the global context’s variable object (VO) will have the following properties:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/variable-object.png" alt="Figure 7\. The global variable object." title="Figure 7\. The global variable object."><br><br>Figure 7. The global variable object.<br><br>See again, that function “baz” being a <em>function expression</em> is not included into the variable object. That’s why we have a <em>ReferenceError</em> when trying to access it outside the function itself.<br><br>Notice, that in contrast with other languages (e.g. C/C++) in ECMAScript <em>only functions</em> create a new scope. Variables and inner functions defined within a scope of a function are not visible directly outside and do not pollute the global variable object.<br><br>Using <em>eval</em> we also enter a new (eval’s) execution context. However, eval uses either a global’s variable object, or a variable object of the caller (e.g. a function from which <em>eval</em> is called).<br><br>And what about functions and their variable objects? In a function context, a variable object is presented as an <em>activation object</em>.<br><br>## <a href="#activation-object">Activation object</a><br><br>When a function is <em>activated</em> (called) by the caller, a special object, called an <em>activation object</em> is created. It’s filled with <em>formal parameters</em> and the special <em>arguments</em> object (which is a map of formal parameters but with index-properties). The <em>activation object</em> then is used as a <em>variable object</em> of the function context.<br><br>I.e. a function’s variable object is the same simple variable object, but besides variables and function declarations, it also stores formal parameters and <em>arguments</em> object and called the <em>activation object</em>.<br><br>Considering the following example:<br><div id="highlighter_79198" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>foo(x, y) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>z = 30;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``function</code> <code>bar() {} ``// FD</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``(``function</code> <code>baz() {}); ``// FE</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>foo(10, 20);</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>we have the next activation object (AO) of the “foo” function context:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/activation-object.png" alt="Figure 8\. An activation object." title="Figure 8\. An activation object."><br><br>Figure 8. An activation object.<br><br>And again a <em>function expression</em> “baz” is not included into the variable/activate object.<br><br>The complete description with all subtle cases (such as <em>“hoisting”</em> of variables and function declarations) of the topic may be found in the same name <a href="http://dmitrysoshnikov.com/ecmascript/chapter-2-variable-object/" target="_blank" rel="external">Chapter 2. Variable object</a>.<br><br>And we are moving forward to the next section. As is known, in ECMAScript we may use <em>inner functions</em> and in these inner function we may refer to variables of <em>parent</em> functions or variables of the <em>global</em> context. As we named a variable object as a <em>scope object</em> of the context, similarly to the discussed above prototype chain, there is so-called a <em>scope chain</em>.<br><br>## <a href="#scope-chain">Scope chain</a><br><br>A <em>scope chain</em> is a <em>list of objects</em> that are searched for <em>identifiers</em> appear in the code of the context.<br><br>The rule is again simple and similar to a prototype chain: if a variable is not found in the own scope (in the own variable/activation object), its lookup proceeds in the parent’s variable object, and so on.<br><br>Regarding contexts, identifiers are: <em>names</em> of variables, function declarations, formal parameters, etc. When a function refers in its code the identifier which is not a local variable (or a local function or a formal parameter), such variable is called a <em>free variable</em>. And to <em>search these free variables</em> exactly a <em>scope chain</em> is used.<br><br>In general case, a <em>scope chain</em> is a list of all those <em>parent variable objects</em>, <em>plus</em> (in the front of scope chain) the function’s <em>own variable/activation object</em>. However, the scope chain may contain also any other object, e.g. objects dynamically added to the scope chain during the execution of the context — such as <em>with-objects</em> or special objects of <em>catch-clauses</em>.<br><br>When <em>resolving</em> (looking up) an identifier, the scope chain is searched starting from the activation object, and then (if the identifier isn’t found in the own activation object) up to the top of the scope chain — repeat, the same just like with a prototype chain.<br><div id="highlighter_265228" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>x = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>(``function</code> <code>foo() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>y = 20;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``(``function</code> <code>bar() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>z = 30;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// &quot;x&quot; and &quot;y&quot; are &quot;free variables&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// and are found in the next (after</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// bar&#39;s activation object) object</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// of the bar&#39;s scope chain</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``console.log(x + y + z);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``})();</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>})();</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>We may assume the linkage of the scope chain objects via the implicit <strong><em>parent</em></strong> property, which refers to the next object in the chain. This approach may be tested in a <a href="http://dmitrysoshnikov.com/ecmascript/chapter-2-variable-object/#feature-of-implementations-property-__parent__" target="_blank" rel="external">real Rhino code</a>, and exactly this technique is used in <abbr title="ECMAScript 5th edition">ES5</abbr> <em>lexical environments</em> (there it’s named an <em>outer</em> link). Another representation of a scope chain may be a simple array. Using a <strong>parent</strong> concept, we may represent the example above with the following figure (thus parent variable objects are saved in the [[Scope]] property of a function):<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/scope-chain.png" alt="Figure 9\. A scope chain." title="Figure 9\. A scope chain."><br><br>Figure 9. A scope chain.<br><br>At code execution, a scope chain may be augmented using <em>with-statement</em> and <em>catch-clause</em> objects. And since these objects are simple objects, they may have prototypes (and prototype chains). This fact moves to that scope chain lookup is <em>two-dimensional</em>: (1) first considered a scope chain link, and (2) on every scope chain’s link — into the depth of the link’s prototype chain (if the link of course has a prototype).<br><br>For this example:<br><div id="highlighter_260538" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>Object.prototype.x = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>w = 20;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>y = 30;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// in SpiderMonkey global object</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// i.e. variable object of the global</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// context inherits from &quot;Object.prototype&quot;,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// so we may refer &quot;not defined global</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// variable x&quot;, which is found in</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// the prototype chain</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>console.log(x); ``// 10</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>(``function</code> <code>foo() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// &quot;foo&quot; local variables</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>x = 100;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>w = 40;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// &quot;x&quot; is found in the</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// &quot;Object.prototype&quot;, because</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// {z: 50} inherits from it</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``with</code> <code>({z: 50}) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``console.log(w, x, y , z); ``// 40, 10, 30, 50</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// after &quot;with&quot; object is removed</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// from the scope chain, &quot;x&quot; is</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// again found in the AO of &quot;foo&quot; context;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// variable &quot;w&quot; is also local</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``console.log(x, w); ``// 100, 40</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// and that&#39;s how we may refer</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// shadowed global &quot;w&quot; variable in</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// the browser host environment</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``console.log(window.w); ``// 20</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>})();</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>we have the following structure (that is, before we go to the <strong>parent</strong> link, first <strong>proto</strong> chain is considered):<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/scope-chain-with.png" alt="Figure 10\. A \" title="Figure 10\. A \"><br><br>Figure 10. A “with-augmented” scope chain.<br><br>Notice, that not in all implementations the global object inherits from the “Object.prototype”. The behavior described on the figure (with referencing “non-defined” variable “x” from the global context) may be tested e.g. in SpiderMonkey.<br><br>Until all parent variable objects exist, there is nothing special in getting parent data from the inner function — we just traverse through the scope chain resolving (searching) needed variable. However, as we mentioned above, after a context ends, all its state and it itself are <em>destroyed</em>. At the same time an <em>inner function</em> may be <em>returned</em> from the parent function. Moreover, this returned function may be later activated from another context. What will be with such an activation if a context of some free variable is already “gone”? In the general theory, a concept which helps to solve this issue is called a <em>(lexical) closure</em>, which in ECMAScript is directly related with a <em>scope chain</em> concept.<br><br>## <a href="#closures">Closures</a><br><br>In ECMAScript, functions are the “first-class” objects. This term means that functions may be passed as arguments to other functions (in such case they are called <em>“funargs”</em>, short from “functional arguments”). Functions which receive “funargs” are called <em>higher-order functions</em> or, closer to mathematics, <em>operators</em>. Also functions may be returned from other functions. Functions which return other functions are called <em>function valued</em> functions (or functions with <em>functional value</em>).<br><br>There are two conceptual problems related with “funargs” and “functional values”. And these two sub-problems are generalized in one which is called a <em>“Funarg problem”</em> (or “A problem of a functional argument”). And exactly to solve the <em>complete “funarg problem”</em>, the concept of <em>closures</em> was invented. Let’s describe in more detail these two sub-problems (we’ll see that both of them are solved in ECMAScript using a mentioned on figures [[Scope]] property of a function).<br><br>First subtype of the “funarg problem” is an <em>“upward funarg problem”</em>. It appears when a function is returned “up” (to the outside) from another function and uses already mentioned above <em>free variables</em>. To be able access variables of the parent context <em>even after the parent context ends</em>, the inner function <em>at creation moment</em> saves in it’s [[Scope]] property parent’s <em>scope chain</em>. Then when the function is <em>activated</em>, the scope chain of its context is formed as combination of the activation object and this [[Scope]] property (actually, what we’ve just seen above on figures):<br><div id="highlighter_393892" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>Scope chain = Activation object + [[Scope]]</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>Notice again the main thing — exactly at <em>creation moment</em> — a function saves <em>parent’s</em> scope chain, because exactly this <em>saved scope chain</em> will be used for variables lookup then in further calls of the function.<br><div id="highlighter_998509" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>foo() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>x = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``return</code> <code>function</code> <code>bar() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``console.log(x);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// &quot;foo&quot; returns also a function</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// and this returned function uses</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// free variable &quot;x&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>returnedFunction = foo();</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// global variable &quot;x&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>x = 20;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// execution of the returned function</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>returnedFunction(); ``// 10, but not 20</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>This style of scope is called the <em>static (or lexical) scope</em>. We see that the variable “x” is found in the saved [[Scope]] of returned “bar” function. In general theory, there is also a <em>dynamic scope</em> when the variable “x” in the example above would be resolved as 20, but not 10. However, dynamic scope is not used in ECMAScript.<br><br>The second part of the “funarg problem”  is a <em>“downward funarg problem”</em>. In this case a parent context may exist, but may be an ambiguity with resolving an identifier. The problem is: <em>from which scope</em> a value of an identifier should be used — statically saved at a function’s creation or dynamically formed at execution (i.e. a scope of a <em>caller</em>)? To avoid this ambiguity and to form a closure, a <em>static scope</em> is decided to be used:<br><div id="highlighter_396340" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// global &quot;x&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>x = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// global function</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>foo() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``console.log(x);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>(``function</code> <code>(funArg) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// local &quot;x&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>x = 20;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// there is no ambiguity,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// because we use global &quot;x&quot;,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// which was statically saved in</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// [[Scope]] of the &quot;foo&quot; function,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``// but not the &quot;x&quot; of the caller&#39;s scope,</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``// which activates the &quot;funArg&quot;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``funArg(); ``// 10, but not 20</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>})(foo); ``// pass &quot;down&quot; foo as a &quot;funarg&quot;</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>We may conclude that a <em>static scope</em> is an <em>obligatory requirement to have closures</em> in a language. However, some languages may provided combination of dynamic and static scopes, allowing a programmer to choose — what to closure and what do not. Since in ECMAScript only a static scope is used (i.e. we have solutions for both subtypes of the “funarg problem”), the conclusion is: <em>ECMAScript has complete support of closures</em>, which technically implemented using [[Scope]] property of functions. Now we may give a correct definition of a closure:<br><br>A <em>closure</em> is a combination of a code block (in ECMAScript this is a function) and statically/lexically saved all parent scopes. Thus, via these saved scopes a function may easily refer free variables.<br><br>Notice, that since <em>every</em> (normal) function saves [[Scope]] at creation, theoretically, <em>all functions</em> in ECMAScript <em>are closures</em>.<br><br>Another important thing to note, that several functions may have <em>the same parent scope</em> (it’s quite a normal situation when e.g. we have two inner/global functions). In this case variables stored in the [[Scope]] property are <em>shared between all functions</em> having the same parent scope chain. Changes of variables made by one closure are <em>reflected</em> on reading these variables in another closure:<br><div id="highlighter_606188" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>baz() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``var</code> <code>x = 1;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``return</code> <code>{</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``foo: ``function</code> <code>foo() { ``return</code> <code>++x; },</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``bar: ``function</code> <code>bar() { ``return</code> <code>--x; }</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>closures = baz();</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>console.log(</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``closures.foo(), ``// 2</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``closures.bar() ``// 1</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>);</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>This code may be illustrated with the following figure:<br><br><img src="http://dmitrysoshnikov.com/wp-content/uploads/shared-scope.png" alt="Figure 11\. A shared [[Scope]]." title="Figure 11\. A shared [[Scope]]."><br><br>Figure 11. A shared [[Scope]].<br><br>Exactly with this feature a confusion with creating several function in a loop is related. Using a loop counter inside created functions, some programmers often get unexpected results when all functions have the <em>same</em> value of a counter inside a function. Now it should be clear why it is so — because all these functions have the same [[Scope]] where the loop counter has the last assigned value.<br><div id="highlighter_844118" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>data = [];</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>for</code> <code>(``var</code> <code>k = 0; k &amp;lt; 3; k++) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``data[k] = ``function</code> <code>() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``alert(k);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>data[0](); ``// 3, but not 0</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>data[1](); ``// 3, but not 1</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>data[2](); ``// 3, but not 2</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>There are several techniques which may solve this issue. One of the techniques is to provide an additional object in the scope chain — e.g. using additional function:<br><div id="highlighter_752947" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>data = [];</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>for</code> <code>(``var</code> <code>k = 0; k &amp;lt; 3; k++) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``data[k] = (``function</code> <code>(x) {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``return</code> <code>function</code> <code>() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``alert(x);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``})(k); ``// pass &quot;k&quot; value</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// now it is correct</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>data[0](); ``// 0</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>data[1](); ``// 1</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>data[2](); ``// 2</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>Those who interested deeper in theory of closures and their practical application, may find additional information in the <a href="http://dmitrysoshnikov.com/ecmascript/chapter-6-closures/" target="_blank" rel="external">Chapter 6. Closures</a>. And to get more information about a scope chain, take a look on the same name <a href="http://dmitrysoshnikov.com/ecmascript/chapter-4-scope-chain/" target="_blank" rel="external">Chapter 4. Scope chain</a>.<br><br>And we’re moving to the next section, considering the last property of an execution context. This is concept of a <em>this value</em>.<br><br>## <a href="#this-value">This value</a><br><br>A <em>this value</em> is a special object which is related with the execution context. Therefore, it may be named as a <em>context object</em> (i.e. an object in which context the execution context is <em>activated</em>).<br><br><em>Any object</em> may be used as <em>this value</em> of the context. I’d like to clarify again the misconception raises sometimes in some descriptions related with execution context of ECMAScript and in particular <em>this value</em>. Often, a <em>this value</em>, <em>incorrectly</em>, is described as a property of the variable object. The recent such a mistake was e.g. in <a href="http://yuiblog.com/assets/High_Perf_JavaScr_Ch2.pdf" target="_blank" rel="external">this book</a> (thought, the mentioned chapter of the book is quite good). Remember once again:<br><br>a <em>this value</em> is a <em>property of the execution context</em>, but <em>not</em> a property of the variable object.<br><br>This feature is very important, because in <em>contrary to variables</em>, <em>this value never participates in identifier resolution process</em>. I.e. when accessing <em>this</em> in a code, its value is taken <em>directly</em> from the execution context and <em>without any scope chain lookup</em>. The value of <em>this</em> is determinate <em>only once</em> when <em>entering the context</em>.<br><br>By the way, in contrast with ECMAScript, e.g. Python has its <em>self</em> argument of methods as a simple variable which is resolved the same and may be even changed during the execution to another value. In ECMAScript it is <em>not possible</em> to assign a new value to <em>this</em>, because, repeat, it’s not a variable and is not placed in the variable object.<br><br>In the global context, a <em>this value</em> is the <em>global object itself</em> (that means, <em>this value</em> here equals to <em>variable object</em>):<br><div id="highlighter_615033" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>x = 10;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>console.log(</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``x, ``// 10</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>``this``.x, ``// 10</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``window.x ``// 10</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>);</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>In case of a function context, <em>this value</em> in <em>every single function call</em> may be <em>different</em>. Here <em>this value</em> is provided by the <em>caller</em> via the <em>form of a call expression</em> (i.e. the way of how a function is activated). For example, the function “foo” below is a <em>callee</em>, being called from the global context, which is a <em>caller</em>. Let’s see on the example, how for the same code of a function, <em>this value</em> in different calls (different ways of the function activation) is provided <em>differently</em> by the caller:<br><div id="highlighter_776566" class="syntaxhighlighter nogutter  jscript"><br><div class="lines"><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// the code of the &quot;foo&quot; function</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// never changes, but the &quot;this&quot; value</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// differs in every activation</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>function</code> <code>foo() {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``alert(``this``);</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>}</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>// caller activates &quot;foo&quot; (callee) and</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>// provides &quot;this&quot; for the callee</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>foo(); ``// global object</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>foo.prototype.constructor(); ``// foo.prototype</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>bar = {</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>``baz: foo</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>};</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>bar.baz(); ``// bar</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>(bar.baz)(); ``// also bar</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>(bar.baz = bar.baz)(); ``// but here is global object</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>(bar.baz, bar.baz)(); ``// also global object</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>(``false</code> <code>|| bar.baz)(); ``// also global object</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt2"><br><table><br><tbody><br><tr><br><td class="content"><code>var</code> <code>otherFoo = bar.baz;</code></td><br></tr><br></tbody><br></table><br></div><br><div class="line alt1"><br><table><br><tbody><br><tr><br><td class="content"><code>otherFoo(); ``// again global object</code></td><br></tr><br></tbody><br></table><br></div><br></div><br></div><br>To consider deeply why (and that is more essential — <em>how</em>) <em>this value</em> may change in every function call, you may read <a href="http://dmitrysoshnikov.com/ecmascript/chapter-3-this/" target="_blank" rel="external">Chapter 3. This</a> where all mentioned above cases are discussed in detail.<br><br>## <a href="#conclusion">Conclusion</a><br><br>At this step we finish this brief overview. Though, it turned out to not so “brief”  However, the whole explanation of all these topics requires a complete book. We though didn’t touch two major topics: <em>functions</em> (and the difference between some types of functions, e.g. <em>function declaration</em> and <em>function expression</em>) and the <em>evaluation strategy</em> used in ECMAScript. Both topics may be found in the appropriate chapters of ES3 series: <a href="http://dmitrysoshnikov.com/ecmascript/chapter-5-functions/" target="_blank" rel="external">Chapter 5. Functions</a> and <a href="http://dmitrysoshnikov.com/ecmascript/chapter-8-evaluation-strategy/" target="_blank" rel="external">Chapter 8. Evaluation strategy</a>.<br><br>If you have comments, questions or additions, I’ll be glad to discuss them in <a>comments page</a>.<br><br>Good luck in studying ECMAScript!<br><br><strong>Written by:</strong> Dmitry A. Soshnikov<br><br><strong>Published on: </strong>2010-09-02<br><br></div>
      
    </div>
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/JavaScript/">JavaScript</a>
    </span>
    

    

    </div>

    
  </div>
</article>

  




    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2016 独孤逸辰
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>
