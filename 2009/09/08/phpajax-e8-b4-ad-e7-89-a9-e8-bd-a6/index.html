<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>php+Ajax购物车 | 美拓blog | 做个有趣的人</title>

  
  <meta name="author" content="独孤逸辰">
  

  
  <meta name="description" content="互联网开发者，金融爱好者,关注农业民生。">
  

  
  
  <meta name="keywords" content="jQuery">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="php+Ajax购物车"/>

  <meta property="og:site_name" content="美拓blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="美拓blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">美拓blog</a>
    </h1>
    <p class="site-description">做个有趣的人</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article >

  
    
    <h3 class="article-title"><span>php+Ajax购物车</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2009/09/08/phpajax-e8-b4-ad-e7-89-a9-e8-bd-a6/" rel="bookmark">
        <time class="entry-date published" datetime="2009-09-08T02:20:24.000Z">
          2009-09-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>今天发布一个简单的php+Ajax的购物车，这个购物车分为一个<br><span style="color: #ff0000;">购物车类</span>:shop_cart.php<br><span style="color: #ff0000;">购物车的操作</span>：cart_action.php<br><span style="color: #ff0000;">首页</span>：index.html<br>Ajax操作用到了jquery，还有一个jquery插件thickbox<br><a id="more"></a></p>
<p>不多说了你可以先看看效果<span style="color: #ff0000;"><span style="text-decoration: underline;"><strong><a href="wp-content/uploads/cart">示例</a></strong></span></span><br>shop_cart.php当然是购物车的核心，但是这个类很简单，因为他又引进了cart_action.php用于对外操作。所以这个类显得相当精简。<br><span style="text-decoration: underline;"><strong><span style="color: #ff0000;">购物车类shop_cart.php</span></strong></span><br>[code=”php”]<br>cart_name = $name;<br>$this-&gt;items = $_SESSION[$this-&gt;cart_name];<br>}</p>
<p>/**</p>
<ul>
<li>setItemQuantity() - Set the quantity of an item.<br>*</li>
<li>@param string $order_code The order code of the item.</li>
<li>@param int $quantity The quantity.<br>*/<br>function setItemQuantity($order_code, $quantity) {<br>$this-&gt;items[$order_code] = $quantity;<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>getItemPrice() - Get the price of an item.<br>*</li>
<li>@param string $order_code The order code of the item.</li>
<li>@return int The price.<br>*/<br>function getItemPrice($order_code) {<br>// This is where the code taht retrieves prices<br>// goes. We’ll just say everything costs $9.99 for this tutorial.<br>return 9.99;<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>getItemName() - Get the name of an item.<br>*</li>
<li>@param string $order_code The order code of the item.<br>*/<br>function getItemName($order_code) {<br>// This is where the code that retrieves product names<br>// goes. We’ll just return something generic for this tutorial.<br>return ‘My Product (‘ . $order_code . ‘)’;<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>getItems() - Get all items.<br>*</li>
<li>@return array The items.<br>*/<br>function getItems() {<br>return $this-&gt;items;<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>hasItems() - Checks to see if there are items in the cart.<br>*</li>
<li>@return bool True if there are items.<br>*/<br>function hasItems() {<br>return (bool) $this-&gt;items;<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>getItemQuantity() - Get the quantity of an item in the cart.<br>*</li>
<li>@param string $order_code The order code.</li>
<li>@return int The quantity.<br>*/<br>function getItemQuantity($order_code) {<br>return (int) $this-&gt;items[$order_code];<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>clean() - Cleanup the cart contents. If any items have a</li>
<li>quantity less than one, remove them.<br>*/<br>function clean() {<br>foreach ( $this-&gt;items as $order_code=&gt;$quantity ) {<br>if ( $quantity &lt; 1 )                 unset($this-&gt;items[$order_code]);<br>}<br>}</li>
</ul>
<p>/**</p>
<ul>
<li>save() - Saves the cart to a session variable.<br>*/<br>function save() {<br>$this-&gt;clean();<br>$_SESSION[$this-&gt;cart_name] = $this-&gt;items;<br>}<br>}</li>
</ul>
<p>?&gt;</p>
<p>[/code]<br>对于cart_action，他实现了shop_cart类与index的中间作用，用于更新，删除，增加商品的操作。<br><span style="text-decoration: underline;"><strong><span style="color: #ff0000;">cart_action.php</span></strong></span><br>[code=”php”]<br>getItemQuantity($_GET[‘order_code’])+$_GET[‘quantity’];<br>$Cart-&gt;setItemQuantity($_GET[‘order_code’], $quantity);<br>}else{</p>
<p>if ( !empty($_GET[‘quantity’]) ) {<br>foreach ( $_GET[‘quantity’] as $order_code=&gt;$quantity){<br>$Cart-&gt;setItemQuantity($order_code, $quantity);<br>}<br>}</p>
<p>if ( !empty($_GET[‘remove’]) ) {<br>foreach ( $_GET[‘remove’] as $order_code ) {<br>$Cart-&gt;setItemQuantity($order_code, 0);<br>}<br>}<br>}<br>$Cart-&gt;save();</p>
<p>header(‘Location: cart.php’);</p>
<p>?&gt;<br>[/code]<br>还有就是index.html实现对外的操作，也就是添加操作<br>[code=”html”]<br>&lt;!DOCTYPE html PUBLIC “-//W3C//DTD XHTML 1.0 Transitional//EN” “<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;" target="_blank" rel="external">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</a></p>
<html xmlns="http://www.w3.org/1999/xhtml"><br><head><br><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><br><title>Shopping Cart</title><br><script src="js/jquery-1.2.6.pack.js" type="text/javascript"></script><br><script src="js/jquery.color.js" type="text/javascript"></script><br><script src="js/thickbox.js" type="text/javascript"></script><br><script src="js/cart.js" type="text/javascript"></script><br><link href="css/style.css" rel="stylesheet" type="text/css" media="screen"><br><link href="css/thickbox.css" rel="stylesheet" type="text/css" media="screen"><br><br><script type="text/javascript"><br>$(function() {<br>$(“form.cart_form”).submit(function() {<br>var title = “Your Shopping Cart”;<br>var orderCode = $(“input[name=order_code]”, this).val();<br>var quantity = $(“input[name=quantity]”, this).val();<br>var url = “cart_action.php?order_code=” + orderCode + “&amp;amp;amp;amp;amp;amp;amp;quantity=” + quantity + “&amp;amp;amp;amp;amp;amp;amp;TB_iframe=true&amp;amp;amp;amp;amp;amp;amp;height=400&amp;amp;amp;amp;amp;amp;amp;width=780”;<br>tb_show(title, url, false);<br><br>return false;<br>});<br>});<br></script><br></head><br><body><br><div id="container"><br><br># 购物车<br><br><a href="cart.php?KeepThis=true&amp;amp;amp;amp;amp;amp;amp;TB_iframe=true&amp;amp;amp;amp;amp;amp;amp;height=400&amp;amp;amp;amp;amp;amp;amp;width=780" title="Your Shopping Cart">打开购物车</a><br><br><em> </em> <em><br><br><a href="cart_action.php?order_code=KWL-JFE&amp;amp;amp;amp;amp;amp;amp;quantity=3&amp;amp;amp;amp;amp;amp;amp;TB_iframe=true&amp;amp;amp;amp;amp;amp;amp;height=400&amp;amp;amp;amp;amp;amp;amp;width=780" title="Your Shopping Cart">添加三个 KWL-JFE 到购物车</a>

</em> <em> </em><br><br><form class="cart_form" action="cart_action.php" method="get"><br><input type="hidden" name="order_code" value="KWL-JFE"><br><label>KWL-JFE: <input class="center" type="text" name="quantity" value="1" size="3" ?=""></label><br><input type="submit" name="submit" value="添加到购物车"><br></form><br></div><br></body><br></html>

<p>[/code]</p>
<p>还有就是<strong><span style="text-decoration: underline;"><span style="color: #ff0000;">cart.php</span></span></strong>这是我们的购物车<br>[code=”php”]<br>&lt;?php<br>include(‘shopping_cart.class.php’);<br>session_start();<br>$Cart = new Shopping_Cart(‘shopping_cart’);<br>?&gt;<br>&lt;!DOCTYPE html PUBLIC “-//W3C//DTD XHTML 1.0 Transitional//EN” “<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;" target="_blank" rel="external">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</a></p>
<p><html xmlns="http://www.w3.org/1999/xhtml"></html></p>
<p><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></p>
<p><head></head></p>
<p><title>Shopping Cart</title></p>
<p><script src="js/jquery-1.2.6.pack.js" type="text/javascript"></script></p>
<p><script src="js/jquery.color.js" type="text/javascript"></script></p>
<p><script src="js/cart.js" type="text/javascript"></script></p>
<p><link href="css/cart.css" rel="stylesheet" type="text/css" media="screen"><br></p>
<p><body></body></p>
<div id="container">

<h1 id="Shopping-Cart"><a href="#Shopping-Cart" class="headerlink" title="Shopping Cart"></a>Shopping Cart</h1><p>&lt;?php if ( $Cart-&gt;hasItems() ) : ?&gt;</p>
<p><form action="cart_action.php" method="get"></form></p>
<p><table id="cart"></table></p>
<p><tr></tr></p>
<p><th>数量</th></p>
<p><th>商品名称</th></p>
<p><th>商品编号</th></p>
<p><th>单价</th></p>
<p><th>总价</th></p>
<p><th>删除</th><br><br>&lt;?php<br>$total_price = $i = 0;<br>foreach ( $Cart-&gt;getItems() as $order_code=&gt;$quantity ) :<br>$total_price += $quantity*$Cart-&gt;getItemPrice($order_code);<br>?&gt;<br>&lt;?php echo $i++%2==0 ? “<tr>“ : “</tr><tr class="odd">“; ?&gt;</tr></p>
<p><td class="quantity center"><input type="text" name="quantity[<?php echo $order_code; ?>]" size="3" value="<?php echo $quantity; ?>" tabindex="<?php echo $i; ?>"></td></p>
<p><td class="item_name">&lt;?php echo $Cart-&gt;getItemName($order_code); ?&gt;</td></p>
<p><td class="order_code">&lt;?php echo $order_code; ?&gt;</td></p>
<p><td class="unit_price">$&lt;?php echo $Cart-&gt;getItemPrice($order_code); ?&gt;</td></p>
<p><td class="extended_price">$&lt;?php echo ($Cart-&gt;getItemPrice($order_code)*$quantity); ?&gt;</td></p>
<p><td class="remove center"><input type="checkbox" name="remove[]" value="<?php echo $order_code; ?>"></td><br><br>&lt;?php endforeach; ?&gt;</p>
<p><tr><td colspan="2"></td><td colspan="3" id="total_price">您的消费总金额是:￥&lt;?php echo $total_price; ?&gt;</td></tr><br></p>
<p><input type="submit" name="update" value="保存购物车"><br><br>&lt;?php else: ?&gt;</p>
<p>您还没有购物.</p>
<p>&lt;?php endif; ?&gt;</p>
<p><a href="load.php">加载简单的购物车</a></p>
<p></p></div><br><br><br>[/code]<br>还要贴的是我们的<strong><span style="text-decoration: underline;"><span style="color: #ff0000;">js代码</span></span></strong>，Ajax操作全靠它啊<br>[code=”javascript”]<br>$(function() {<br>$(“#cart tr .remove input”).click(function() {<br>var orderCode = $(this).val();<br>$.ajax({<br>type: “GET”,<br>url: “cart_action.php”,<br>data: “remove[]=” + orderCode,<br>success: function() {<br>$(“#cart tr .remove input[value=” + orderCode + “]”).parent().parent().fadeOut(500, function() {<br>$(this).remove();<br>calcPrice();<br>});<br>},<br>error: function() {<br>window.location(“cart_action.php?remove[]=”+orderCode);<br>}<br>});<br>});<p></p>
<p>$(“#cart tr .quantity input”).change(function() {<br>var orderCode = $(this).attr(“name”).slice(9, -1);<br>var quantity = $(this).val();<br>$.ajax({<br>type: “GET”,<br>url: “cart_action.php”,<br>data: “quantity[“ + orderCode + “]=” + quantity,<br>success: function() {<br>var startColor = $(“#cart tr .quantity input[name<em>=” + orderCode + “]”).parent().parent().hasClass(“odd”) ? “#eee” : “#fff”;<br>$(“#cart tr .quantity input[name</em>=” + orderCode + “]”).parent().parent().find(“td”).animate({ backgroundColor: “#ff8” }, 100).animate({ backgroundColor: startColor }, 800);<br>calcPrice();<br>},<br>error: function() {<br>window.location(“cart_action.php?quantity[“ + orderCode + “]=” + quantity);<br>}<br>});<br>});<br>});</p>
<p>function calcPrice() {<br>var totalPrice = 0;<br>$(“#cart tr .quantity”).parent().each(function() {<br>var quantity = $(“.quantity input”, this).val();<br>var unitPrice = $(“.unit_price”, this).text().slice(1);<br>var extendedPrice = quantity*unitPrice;<br>totalPrice += extendedPrice;</p>
<p>$(“.extended_price”, this).html(“$” + extendedPrice);<br>$(“#total_price”).html(“您的总消费金额是￥”+totalPrice);<br>});<br>if ( totalPrice == 0 ) {<br>$(“#cart”).parent().replaceWith(“</p>
<p>您的购物车里没有商品.<br>“);<br>}<br>}<br>[/code]</p>
<p>你看懂了么，呵呵，我是看了好一会啊，这不是我写的，原来有错误我给改了一下，代码贴的不全想要源码么，可以向我要啊。。</p>
<p>PS:由于很多人找我要，所以将源码打包放了上来。</p>
<p><a href="http://down.qiannao.com/space/file/cuijiudai/-4e0a-4f20-5206-4eab/cart.zip/.page" target="_blank" rel="external">点此–千脑下载</a><br><a href="http://code.google.com/p/meito/downloads/list" target="_blank" rel="external">点此–Google项目下载</a></p>

      
    </div>
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/ajax/">ajax</a>, <a href="/categories/ajax/PHP/">PHP</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/jQuery/">jQuery</a>
    </span>
    

    </div>

    
  </div>
</article>

  




    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2016 独孤逸辰
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>
